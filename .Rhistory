labs(x = "ln(distance to city center, miles)", y = "Price (US dollars)") +
theme_bg()
p3
# plotting LOG-LOG LINEAR REGRESSION
p4 <- ggplot(data = hotels, aes(x = lndistance, y = lnprice)) +
geom_point_da() +
geom_smooth_da(method = "lm") +
expand_limits(x = 0.01, y = 0.01) +
scale_y_continuous(expand = c(0.01, 0.01), limits = c(3.5, 6), breaks = seq(3.5, 6, by = 0.50)) +
labs(x = "ln(distance to city center, miles)", y = "ln(price, US dollars)") +
theme_bg()
p4
p3 | p4
# CASE STUDY: How is Life Expectancy Related to the Average Income of a Country?
# load data
xc <- read_csv("input/worldbank-lifeexpectancy.csv")
# select year
xc <- xc |> filter(year == 2017)
# GDP total, log
xc <- xc |>
mutate(gdptot = gdppc * population) |>
mutate(lngdppc = log(gdppc)) |>
mutate(lngdptot = log(gdptot))
xc |>
dplyr::select(lifeexp, gdppc, gdptot, lngdppc, lngdptot) |>
summary()
# plotting the distribution of GDP per capita (level and log)
# level
p1 <- ggplot(
data = xc,
aes(x = gdppc, y = (..count..) / sum(..count..))
) +
geom_histogram(
binwidth = 3, boundary = 0, closed = "left",
color = color.outline, fill = color[1], size = 0.25, alpha = 0.8, show.legend = F, na.rm = TRUE
) +
labs(x = "GDP per capita (thousand US dollars)", y = "Percent") +
expand_limits(x = 0.01, y = 0.01) +
scale_x_continuous(expand = c(0.01, 0.01), limits = c(0, 120), breaks = seq(0, 120, by = 15)) +
scale_y_continuous(expand = c(0.0, 0.0), limits = c(0, 0.2), breaks = seq(0, 0.20, by = 0.04), labels = scales::percent_format(accuracy = 1)) +
theme_bg()
p1
# log
p2 <- ggplot(
data = xc,
aes(x = lngdppc, y = (..count..) / sum(..count..))
) +
geom_histogram(
binwidth = 0.2, boundary = 0, closed = "left",
color = color.outline, fill = color[1], size = 0.25, alpha = 0.8, show.legend = F, na.rm = TRUE
) +
labs(x = "ln(GDP per capita, thousand US dollars)", y = "Percent") +
scale_x_continuous(expand = c(0.01, 0.01), limits = c(0, 5), breaks = seq(0, 5, by = 1)) +
scale_y_continuous(expand = c(0.0, 0.0), limits = c(0, 0.1), breaks = seq(0, 0.10, by = 0.02), labels = scales::percent_format(accuracy = 1)) +
theme_bg()
p2
p1 | p2
# running linear regression
reg1 <- lm(lifeexp ~ gdppc, data = xc)
summary(reg1)
# plotting LEVEL-LEVEL REGRESSION
p3 <- ggplot(
data = xc,
aes(x = gdppc, y = lifeexp)
) +
geom_point_da() +
geom_smooth_da(method = "lm") +
coord_cartesian(xlim = c(0, 120), ylim = c(50, 100)) +
expand_limits(x = 0.01, y = 0.01) +
scale_x_continuous(expand = c(0.01, 0.01), limits = c(0, 120), breaks = seq(0, 120, by = 20)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 100, by = 5)) +
labs(x = "GDP per capita (thousand US dollars)", y = "Life expectancy  (years)") +
theme_bg()
p3
# running linear regression log per capita
reg2 <- lm(lifeexp ~ lngdppc, data = xc)
summary(reg2)
# plotting life expectancy and GDP log per capita
p4 <- ggplot(
data = xc,
aes(x = lngdppc, y = lifeexp)
) +
geom_point_da() +
geom_smooth_da(method = "lm") +
coord_cartesian(xlim = c(-0.5, 4.8), ylim = c(50, 85)) +
scale_x_continuous(breaks = seq(-0.5, 4.5, by = 0.5)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "ln(GDP per capita, thousand US dollars) ", y = "Life expectancy  (years)") +
theme_bg()
p4
# plotting life expectancy and GDP log per capita (in scale)
p5 <- ggplot(
data = xc,
aes(x = gdppc, y = lifeexp)
) +
geom_point_da() +
geom_smooth_da(method = "lm") +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p5
p4 | p5
# running linear regression total GDP
reg3 <- lm(lifeexp ~ gdptot, data = xc)
summary(reg3)
# plotting LEVEL-LEVEL REGRESSION (total GDP)
p6 <- ggplot(
data = xc,
aes(x = gdptot, y = lifeexp)
) +
geom_point_da() +
geom_smooth_da(method = "lm") +
coord_cartesian(xlim = c(0, 24000), ylim = c(50, 85)) +
expand_limits(x = 0.01, y = 0.01) +
scale_x_continuous(expand = c(0.01, 0.01), limits = c(0, 24000), breaks = seq(0, 24000, by = 4000)) +
scale_y_continuous(expand = c(0.01, 0.01), limits = c(50, 85), breaks = seq(50, 85, by = 5)) +
labs(x = "Total GDP  (billion US dollars)", y = "Life expectancy  (years)") +
theme_bg()
p6
# running linear regression log total GDP
reg4 <- lm(lifeexp ~ lngdptot, data = xc)
summary(reg4)
# plotting LEVEL-LOG REGRESSION (total GDP)
p7 <- ggplot(
data = xc,
aes(x = gdptot, y = lifeexp)
) +
geom_point_da() +
geom_smooth_da(method = "lm") +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 10000)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = c(50, 55, 60, 65, 70, 75, 80, 85)) +
labs(x = "Total GDP (in ln scale))", y = "Life expectancy  (years)") +
theme_bg()
p7
# CASE STUDY: How is Life Expectancy Related to the Average Income of a Country?
# GPD PER CAPITA PIECEWISE LINEAR SPLINE
# setting the knot (GDP per capita over 50 000 dollars)
cutoff <- 50
# creating the log
cutoff_ln <- log(cutoff)
# running piecewise linear spline regression on log
reg5 <- lm(lifeexp ~ lspline::lspline(lngdppc, cutoff_ln), data = xc)
summary(reg5)
# running test of coefficients to check differences in slope for the different segments (5.5 vs -0.3)
lmtest::coeftest(reg5)
# calculating the residuals and creating a new variable
xc$e3 <- resid(reg5)
# calculating the predictions for the piecewise linear spline regression model
xc$sppred <- predict(lm(lifeexp ~ lspline::lspline(lngdppc, cutoff_ln), data = xc))
# plotting a scatterplot with the piecewise linear spline regression model
p1 <- ggplot(
data = xc,
aes(x = gdppc, y = lifeexp)
) +
geom_point_da() +
geom_line(data = xc, aes(x = gdppc, y = sppred), color = color[2], size = 0.7) +
geom_vline(xintercept = cutoff, color = color[3], size = 0.5, linetype = "dotted") +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
# QUADRATIC IN LEVEL-LOG REGRESSION
# calculating the quadratic function
xc$lngdppc_sq <- xc$lngdppc^2
# running the polynomial (quadratic) linear regression
reg6 <- lm(lifeexp ~ lngdppc + lngdppc_sq, data = xc)
summary(reg6)
# calculating the residuals and creating a new variable
xc$e6 <- resid(reg6)
# plotting a scatterplot with the polynomial (quadratic) nonlinear regression (in scale)
p2 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point_da() +
geom_smooth(method = "lm", formula = y ~ poly(x, 2), color = color[2], se = F, size = 0.7) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p2
# plotting a scatterplot with the polynomial (quadratic) nonlinear regression (ln units)
p3 <- ggplot(data = xc, aes(x = lngdppc, y = lifeexp)) +
geom_point_da() +
geom_smooth(method = "lm", formula = y ~ poly(x, 2), color = color[2], se = F, size = 0.7) +
coord_cartesian(xlim = c(-1, 5), ylim = c(50, 90)) +
scale_x_continuous(breaks = seq(-1, 5, by = 0.5)) +
scale_y_continuous(breaks = seq(50, 90, by = 5)) +
labs(x = "ln(GDP per capita, thousand US dollars)", y = "Life expectancy  (years)") +
theme_bg()
p3
p1 | p2
# lintr::lint("main.Rmd", linters =
#               lintr::with_defaults(
#                 commented_code_linter = NULL,
#                 trailing_whitespace_linter = NULL
#                 )
#             )
# if you have additional scripts and want them to be linted too, add them here
# lintr::lint("scripts/my_script.R")
glimpse(hotels)
styler:::style_selection()
styler:::style_selection()
styler:::style_selection()
styler:::style_selection()
# CASE STUDY: Regression and measurement erro in average customer ratings
# TAKE LOG PRICE
hotels$lnprice <- log(hotels$price)
# define cutoffs
k1 <- 100
k2 <- 200
# dividing data into three subsamples of roughly equal size
# <100
reg_me <- lm(lnprice ~ rating, data = subset(hotels, rating_count < k1))
summary(reg_me)
hotels$yhat <- predict(reg_me, hotels)
# >=100 < 200
reg_me2 <- lm(lnprice ~ rating, data = subset(hotels, rating_count >= k1 & rating_count < k2))
summary(reg_me2)
hotels$yhat2 <- predict(reg_me2, hotels)
# >200
reg_me3 <- lm(lnprice ~ rating, data = subset(hotels, rating_count >= k2))
summary(reg_me3)
hotels$yhat3 <- predict(reg_me3, hotels)
summary(reg_me)
hotels$yhat
styler:::style_selection()
p1 <- ggplot(data = hotels) +
geom_line(aes(x = rating, y = yhat, color = color[2]), size = 1) +
geom_line(aes(x = rating, y = yhat3, color = color[1]), size = 1) +
scale_color_manual(name = "", values = c(color[2], color[1]), labels = NULL, guide = "none") +
coord_cartesian(xlim = c(2, 5), ylim = c(3.5, 5)) +
expand_limits(x = 0.01, y = 0.01) +
scale_y_continuous(expand = c(0.01, 0.01)) +
scale_x_continuous(expand = c(0.01, 0.01), limits = c(2, 5), breaks = seq(2, 5, by = 0.5)) +
labs(x = "Average rating", y = "ln(Hotel price, US dollars)") +
theme_bg() +
annotate("text", x = 2.6, y = 4.4, label = "More noisy: # of ratings<100", size = 2, color = color[2]) +
annotate("text", x = 3.1, y = 3.6, label = "Less noisy: # of ratings>200", size = 2, color = color[1])
p1
summary(reg_me)
summary(reg_me2)
summary(reg_me3)
styler:::style_selection()
reg7 <- lm(lifeexp ~ lngdppc, data = xc)
summary(reg7)
reg8 <- lm(lifeexp ~ lngdppc, data = xc, weights = population)
summary(reg8)
styler:::style_selection()
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
# geom_segment(aes(x = 2, y = 25, xend = 1.15, yend = 50), arrow = arrow(length = unit(0.1, "cm")))+
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p1
styler:::style_selection()
p2 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_smooth(method = "lm", color = color[2], se = F, size = 1) +
geom_smooth(aes(weight = population), method = "lm", color = color[3], se = F, size = 1) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p2
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p1
# geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p1
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p1
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
# plotting life expectancy and GDP per capita (unweighted)
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
# plotting life expectancy and GDP per capita (weighted)
p2 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p2
p1 | p2
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point_da(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point_da(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
# plotting life expectancy and GDP per capita (weighted)
p2 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p2
p1 | p2
p3 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_smooth(method = "lm", color = color[2], se = F, size = 1) +
geom_smooth(aes(weight = population), method = "lm", color = color[3], se = F, size = 1) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p3
styler:::style_selection()
p4 <- ggplot(data = xc, aes(x = lngdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.4, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(xlim = c(-1, 5), ylim = c(50, 90)) +
scale_x_continuous(breaks = seq(-1, 5, by = 0.5)) +
scale_y_continuous(breaks = seq(50, 90, by = 5)) +
labs(x = "ln(GDP per capita, thousand US dollars)", y = "Life expectancy  (years)", size = "Population") +
theme_bg()
p4
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point_da(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
# plotting life expectancy and GDP per capita (weighted)
p2 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p2
# plotting life expectancy and log GDP per capita (unweighted)
p3 <- ggplot(data = xc, aes(x = lngdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.4, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(xlim = c(-1, 5), ylim = c(50, 90)) +
scale_x_continuous(breaks = seq(-1, 5, by = 0.5)) +
scale_y_continuous(breaks = seq(50, 90, by = 5)) +
labs(x = "ln(GDP per capita, thousand US dollars)", y = "Life expectancy  (years)", size = "Population") +
theme_bg()
p3
p1 | p2 | p3
# CASE STUDY: How is Life Expectancy Related to the Average Income of a Country?
# running linear regression (unweighted)
reg7 <- lm(lifeexp ~ lngdppc, data = xc)
summary(reg7)
# running linear regression (weighted)
reg8 <- lm(lifeexp ~ lngdppc, data = xc, weights = population)
summary(reg8)
# plotting life expectancy and GDP per capita (unweighted)
p1 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point_da(color = color[1], shape = 16, show.legend = F) +
geom_smooth(method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p1
# plotting life expectancy and GDP per capita (weighted)
p2 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.6, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg() +
annotate("text", x = 70, y = 80, label = "USA", size = 2) +
annotate("text", x = 10, y = 82, label = "China", size = 2) +
annotate("text", x = 7, y = 63, label = "India", size = 2)
p2
# plotting life expectancy and log GDP per capita (unweighted)
p3 <- ggplot(data = xc, aes(x = lngdppc, y = lifeexp)) +
geom_point(data = xc, aes(size = population), color = color[1], shape = 16, alpha = 0.4, show.legend = F) +
geom_smooth(aes(weight = population), method = "lm", color = color[2], se = F, size = 0.7) +
scale_size(range = c(1, 15)) +
coord_cartesian(xlim = c(-1, 5), ylim = c(50, 90)) +
scale_x_continuous(breaks = seq(-1, 5, by = 0.5)) +
scale_y_continuous(breaks = seq(50, 90, by = 5)) +
labs(x = "ln(GDP per capita, thousand US dollars)", y = "Life expectancy  (years)", size = "Population") +
theme_bg()
p3
p1 | p2 | p3
# plotting differences in slope estimates (unweighted vs weighted)
p4 <- ggplot(data = xc, aes(x = gdppc, y = lifeexp)) +
geom_smooth(method = "lm", color = color[2], se = F, size = 1) +
geom_smooth(aes(weight = population), method = "lm", color = color[3], se = F, size = 1) +
scale_size(range = c(1, 15)) +
coord_cartesian(ylim = c(50, 85)) +
scale_x_continuous(trans = log_trans(), breaks = c(0.1, 0.5, 1, 2, 5, 10, 20, 50, 100)) +
scale_y_continuous(expand = c(0.01, 0.01), breaks = seq(50, 85, by = 5)) +
labs(x = "GDP per capita, thousand US dollars (ln scale) ", y = "Life expectancy  (years)") +
theme_bg()
p4
p1 | p2 / p2 | p3
(p1 | p2) / (p2 | p3)
